import React, {useEffect, useRef, useState} from 'react';
import './style.css';
import {NodeUI} from "./node-ui/node-ui";
import {Calc} from "./node-ui/calc";
import {Point} from "./node-ui/svg";
import {MenuConfirm} from "../auxiliary/menu/menu-confirm";

let arrKey = [];


export type TEventData = {
    name: 'selected' | 'dragged' | 'link-create' | 'link-remove' | 'add-node' | 'node-remove' | 'init' | 'key-down' | 'key-up',
    arrSelect?: Element[],
    nui?: NodeUI | null,
    arrKey?: string[]
}

export function Editor({newNode, onEvent}) {
    const nuiRef = useRef<NodeUI | null>(null);
    const editorRef = useRef(null);
    const [confirmShow, setConfirmShow] = useState(() => () => true);

    function eventEmit(eventData: TEventData) {
        onEvent && onEvent(eventData as TEventData)
    }

    useEffect(() => {
        const nui = new NodeUI(editorRef.current! as HTMLElement)
        nuiRef.current = nui;
        //language=HTML
        nui.svg.innerHTML = '<text x="0" y="0" class="pin-text" opacity="0" id="temp-node-for-width-text">value</text><g x="224" y="89" class="node" data-node="sum" data-description="Сумма" transform="translate(201.99999999999994,144.6296296296297)" id="uhqErub"><rect x="0" y="0" width="45.0107421875" height="40" rx="2" stroke="#25334b" fill="#d7d7d7" class="handle"></rect><circle cx="0" cy="12" r="4" stroke="#25334b" fill="#bcffd6" class="pin-in" id="uhqErud" data-name="A" data-to="uhEeA39"></circle><text x="8" y="15" class="pin-text">A</text><circle cx="0" cy="28" r="4" stroke="#25334b" fill="#bcffd6" class="pin-in" id="uhqEruf" data-name="B" data-to="uhEexco"></circle><text x="8" y="31" class="pin-text">B</text><circle cx="45.0107421875" cy="20" r="4" stroke="#25334b" fill="#ffc69a" class="pin-out" id="uhqErug" data-name="out"></circle><text x="24" y="23" class="pin-text">out</text><text x="0" y="-2" class="pin-text">sum</text></g><g x="146" y="208" class="node" data-node="value" data-cfg="JTI1N0IlMjUyMiUyNUQwJTI1QjIlMjVEMSUyNTgyJTI1RDAlMjVCRSUyNUQxJTI1ODAlMjVEMCUyNUIwJTI1RDElMjU4RiUyNTIyJTI1M0ElMjU1QiUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EwJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVBJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ExJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMSUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVCJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EyJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMiUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EwJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVBJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ExJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMSUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVCJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EyJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMiUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EwJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVBJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ExJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMSUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVCJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EyJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMiUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1NUQlMjUyQyUyNTIyJTI1RDAlMjVCRSUyNUQxJTI1ODElMjVEMCUyNUJEJTI1RDAlMjVCRSUyNUQwJTI1QjIlMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1OEYlMjUyMiUyNTNBJTI1NUIlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMmRlc2NyaXB0aW9uJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMnN0cmluZyUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OUUlMjVEMCUyNUJGJTI1RDAlMjVCOCUyNUQxJTI1ODElMjVEMCUyNUIwJTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1JTI1MjIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRGElMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0lMjVEMCUyNUJGJTI1RDAlMjVCMCUyNUQxJTI1ODAlMjVEMCUyNUIwJTI1RDAlMjVCQyUyNUQwJTI1QjUlMjVEMSUyNTgyJTI1RDElMjU4MCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTVEJTI1N0Q=" transform="translate(141,176)" id="uhEexcm"><rect x="0" y="0" width="37.0107421875" height="24" rx="2" stroke="#25334b" fill="#d7d7d7" class="handle"></rect><circle cx="37.0107421875" cy="12" r="4" stroke="#25334b" fill="#ffc69a" class="pin-out" id="uhEexco" data-name="out" data-to="uhqEruf"></circle><text x="16" y="15" class="pin-text">out</text><text x="0" y="-2" class="pin-text">value</text></g><g x="125" y="149" class="node" data-node="value" data-cfg="JTI1N0IlMjUyMiUyNUQwJTI1QjIlMjVEMSUyNTgyJTI1RDAlMjVCRSUyNUQxJTI1ODAlMjVEMCUyNUIwJTI1RDElMjU4RiUyNTIyJTI1M0ElMjU1QiUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EwJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVBJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ExJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMSUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVCJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EyJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMiUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EwJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVBJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ExJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMSUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVCJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EyJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMiUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EwJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVBJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ExJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMSUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWVCJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMm51bWJlciUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0EyJTI1MkMlMjUyMnRpdGxlJTI1MjIlMjUzQSUyNTIyJTI1RDAlMjU5NyUyNUQwJTI1QkQlMjVEMCUyNUIwJTI1RDElMjU4NyUyNUQwJTI1QjUlMjVEMCUyNUJEJTI1RDAlMjVCOCUyNUQwJTI1QjUtMiUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMCUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTAlMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQSUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMSUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTElMjUyMiUyNTdEJTI1MkMlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMnZhbHVlQiUyNTIyJTI1MkMlMjUyMnR5cGUlMjUyMiUyNTNBJTI1MjJudW1iZXIlMjUyMiUyNTJDJTI1MjJ2YWwlMjUyMiUyNTNBMiUyNTJDJTI1MjJ0aXRsZSUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OTclMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1ODclMjVEMCUyNUI1JTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1LTIlMjUyMiUyNTdEJTI1NUQlMjUyQyUyNTIyJTI1RDAlMjVCRSUyNUQxJTI1ODElMjVEMCUyNUJEJTI1RDAlMjVCRSUyNUQwJTI1QjIlMjVEMCUyNUJEJTI1RDAlMjVCMCUyNUQxJTI1OEYlMjUyMiUyNTNBJTI1NUIlMjU3QiUyNTIybmFtZSUyNTIyJTI1M0ElMjUyMmRlc2NyaXB0aW9uJTI1MjIlMjUyQyUyNTIydHlwZSUyNTIyJTI1M0ElMjUyMnN0cmluZyUyNTIyJTI1MkMlMjUyMnZhbCUyNTIyJTI1M0ElMjUyMiUyNUQwJTI1OUUlMjVEMCUyNUJGJTI1RDAlMjVCOCUyNUQxJTI1ODElMjVEMCUyNUIwJTI1RDAlMjVCRCUyNUQwJTI1QjglMjVEMCUyNUI1JTI1MjIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRGElMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0lMjVEMCUyNUJGJTI1RDAlMjVCMCUyNUQxJTI1ODAlMjVEMCUyNUIwJTI1RDAlMjVCQyUyNUQwJTI1QjUlMjVEMSUyNTgyJTI1RDElMjU4MCUyNTIyJTI1N0QlMjUyQyUyNTdCJTI1MjJuYW1lJTI1MjIlMjUzQSUyNTIydmFsdWUlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTAlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0wJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUElMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTElMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0xJTI1MjIlMjU3RCUyNTJDJTI1N0IlMjUyMm5hbWUlMjUyMiUyNTNBJTI1MjJ2YWx1ZUIlMjUyMiUyNTJDJTI1MjJ0eXBlJTI1MjIlMjUzQSUyNTIybnVtYmVyJTI1MjIlMjUyQyUyNTIydmFsJTI1MjIlMjUzQTIlMjUyQyUyNTIydGl0bGUlMjUyMiUyNTNBJTI1MjIlMjVEMCUyNTk3JTI1RDAlMjVCRCUyNUQwJTI1QjAlMjVEMSUyNTg3JTI1RDAlMjVCNSUyNUQwJTI1QkQlMjVEMCUyNUI4JTI1RDAlMjVCNS0yJTI1MjIlMjU3RCUyNTVEJTI1N0Q=" transform="translate(141,131)" id="uhEeA37"><rect x="0" y="0" width="37.0107421875" height="24" rx="2" stroke="#25334b" fill="#d7d7d7" class="handle"></rect><circle cx="37.0107421875" cy="12" r="4" stroke="#25334b" fill="#ffc69a" class="pin-out" id="uhEeA39" data-name="out" data-to="uhqErud"></circle><text x="16" y="15" class="pin-text">out</text><text x="0" y="-2" class="pin-text">value</text></g><path class="link" stroke-linecap="round" d="M202 156.62962341308594 C 194.00358072916666 156.62962341308594, 186.00716145833334 143, 178.0107421875 143" id="uhEeA39-uhqErud"></path><path class="link" stroke-linecap="round" d="M202 172.62962341308594 C 194.00358072916666 172.62962341308594, 186.00716145833334 188, 178.0107421875 188" id="uhEexco-uhqEruf"></path>';

        nui.svg.addEventListener('selected', (e: CustomEvent) => eventEmit({name: 'selected', arrSelect: e.detail}))
        nui.svg.addEventListener('dragged', (e: CustomEvent) => eventEmit({name: 'dragged'}))
        nui.svg.addEventListener('link-create', (e: CustomEvent) => eventEmit({name: 'link-create'}))
        nui.svg.addEventListener('link-remove', (e: CustomEvent) => eventEmit({name: 'link-remove'}))
        nui.svg.addEventListener('node-remove', (e: CustomEvent) => eventEmit({name: 'node-remove'}))

        eventEmit({name: 'init', nui: nuiRef.current})
    }, []);

    function onMouseDown(e) {
        if (nuiRef.current && newNode) {
            const nui = nuiRef.current;
            nui?.updateZoom();
            const {x, y} = nui?.getPosZoom(new Point(e.clientX, e.clientY).sub(nui?.off!));

            let data = {cfg: toBase64(JSON.stringify(newNode.cfg))};

            nuiRef.current?.createNode({
                x, y, nodeName: newNode.name,
                arrIn: newNode.inputs, arrOut: newNode.outputs, data,
                color: newNode.color
            });
            eventEmit({name: 'add-node'})
        }
    }

    function onKeyDown(e) {
        arrKey[e.code.toLowerCase()] = true;
        if (arrKey['delete']) nuiRef.current?.selection.arrSelected!.length > 0 && confirmShow();
        eventEmit({name: 'key-down', arrKey});
    }

    function onKeyUp(e) {
        arrKey[e.code.toLowerCase()] = false;
        eventEmit({name: 'key-up', arrKey});
    }

    return <>
        <div className="editor" onMouseDown={onMouseDown} ref={editorRef} onKeyDown={onKeyDown} onKeyUp={onKeyUp}
             tabIndex="-1"/>
    </>;
}

export const toBase64 = (value: string) => window.btoa(encodeURI(encodeURIComponent(value)));
export const base64to = (value: string) => decodeURIComponent(decodeURI(window.atob(value)));
